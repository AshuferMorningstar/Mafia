<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia Game</title>
    <!-- Font imports for stylized Mafia metallic header -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=20240912e">
</head>
<body>
    <!-- Side Panel (Desktop) / Top Dashboard (Mobile/Tablet) -->
    <nav class="side-panel" id="side-panel">
        <div class="side-panel-title main-title">Mafia Game</div>
        <ul class="side-panel-menu">
            <li><button class="side-panel-btn" onclick="togglePanel('how-to-play')">📖 How to Play</button></li>
            <li><button class="side-panel-btn" onclick="togglePanel('roles-info')">🎭 Roles Info</button></li>
            <li><button class="side-panel-btn" onclick="togglePanel('game-tips')">💡 Game Tips</button></li>
            <li><button class="side-panel-btn" onclick="togglePanel('about')">ℹ️ About</button></li>
        </ul>
    </nav>

    <!-- Information Panels -->
    <div class="info-panel-overlay" id="info-panel-overlay" onclick="closePanel()"></div>
    
    <!-- How to Play Panel -->
    <div class="info-panel" id="how-to-play-panel">
        <div class="info-panel-header">
            <h2>📖 How to Play</h2>
            <button class="close-panel-btn" onclick="closePanel()">✕</button>
        </div>
        <div class="info-panel-content">
            <div class="info-section">
                <h3>� Roles</h3>
                <p><strong>Civilians 👤</strong> – Ordinary players. No powers. Must work together to find the killers.</p>
                <p><strong>Killers 🔪</strong> – Secretly choose one player to eliminate each night. Win by outnumbering civilians.</p>
                <p><strong>Doctor 🩺</strong> – Each night, chooses one player to "save." If that player is targeted, they survive.</p>
                <p><strong>Detective 🔍</strong> – Each night, investigates one player and silently learns if they are a killer.</p>
                <p><strong>Speaker 🎙️</strong> – The moderator. Controls the flow, announces results, and ensures fairness. Never plays as a role.</p>
            </div>
            
            <div class="info-section">
                <h3>⚙️ Setup</h3>
                <ul>
                    <li>Gather at least 6 players + 1 Speaker.</li>
                    <li>Prepare role cards/slips (Civilians, Killers, Doctor, Detective). Shuffle and deal secretly.<br>
                        Players keep their role hidden.<br>
                        Only killers know each other.</li>
                    <li>The Speaker explains the rules and starts the game.</li>
                </ul>
            </div>
            
                        <div class="info-section">
                <h3>🌙 Night Phase</h3>
                <ul>
                    <li>Everyone closes their eyes.</li>
                    <li><strong>Speaker:</strong> "Killers, open your eyes."<br>
                        Killers silently choose one target.<br>
                        Speaker confirms and says: "Killers, close your eyes."</li>
                    <li><strong>Speaker:</strong> "Doctor, open your eyes."<br>
                        Doctor points to one player to save.<br>
                        Speaker confirms and says: "Doctor, close your eyes."</li>
                    <li><strong>Speaker:</strong> "Detective, open your eyes."<br>
                        Detective points to one player.<br>
                        Speaker silently shows a 👍 if they are a killer, 👎 if not.<br>
                        Speaker says: "Detective, close your eyes."</li>
                    <li>Night ends.</li>
                </ul>
            </div>
            
            <div class="info-section">
                <h3>☀️ Day Phase</h3>
                <ul>
                    <li>Everyone opens their eyes.</li>
                    <li><strong>Speaker announces results:</strong><br>
                        If doctor saved the target → "Nobody was eliminated last night."<br>
                        If not saved → "Last night, [Name] was eliminated."</li>
                    <li><strong>Discussion:</strong> All surviving players argue, accuse, and defend themselves.</li>
                    <li><strong>Voting:</strong><br>
                        Speaker says: "On the count of three, point to the player you want to eliminate."<br>
                        Majority vote decides.<br>
                        Eliminated player reveals their role and leaves the game.</li>
                </ul>
            </div>
            
            <div class="info-section">
                <h3>🏆 Win Conditions</h3>
                <p><strong>Civilians win</strong> → All killers are eliminated.</p>
                <p><strong>Killers win</strong> → Killers equal or outnumber civilians.</p>
            </div>
            
            <div class="info-section">
                <h3>⚖️ Role Balance</h3>
                <p><strong>6–7 players</strong> → 1 Killer, 1 Doctor, rest Civilians (no Detective).</p>
                <p><strong>8–10 players</strong> → 2 Killers, 1 Doctor, 1 Detective, rest Civilians.</p>
                <p><strong>11–15 players</strong> → 3 Killers, 1 Doctor, 1 Detective, rest Civilians.</p>
            </div>
        </div>
    </div>
    
    <!-- Roles Info Panel -->
    <div class="info-panel" id="roles-info-panel">
        <div class="info-panel-header">
            <h2>🎭 Roles Information</h2>
            <button class="close-panel-btn" onclick="closePanel()">✕</button>
        </div>
        <div class="info-panel-content">
            <div class="role-card">
                <div class="role-header">
                    <span class="role-icon">�</span>
                    <h3>Civilian</h3>
                </div>
                <p><strong>Goal:</strong> Find and eliminate all killers</p>
                <p><strong>Abilities:</strong> Vote during day phase, discuss with others</p>
                <p><strong>Strategy:</strong> Pay attention to behavior, form alliances carefully</p>
            </div>
            
            <div class="role-card">
                <div class="role-header">
                    <span class="role-icon">🔪</span>
                    <h3>Killer</h3>
                </div>
                <p><strong>Goal:</strong> Eliminate civilians without being caught</p>
                <p><strong>Abilities:</strong> Choose victims at night, blend in during day</p>
                <p><strong>Strategy:</strong> Act innocent, deflect suspicion, coordinate with other killers</p>
            </div>
            
            <div class="role-card">
                <div class="role-header">
                    <span class="role-icon">🩺</span>
                    <h3>Doctor</h3>
                </div>
                <p><strong>Goal:</strong> Keep civilians alive, eliminate killers</p>
                <p><strong>Abilities:</strong> Save one player each night (including yourself)</p>
                <p><strong>Strategy:</strong> Protect key players, stay hidden from killers</p>
            </div>
            
            <div class="role-card">
                <div class="role-header">
                    <span class="role-icon">🔍</span>
                    <h3>Detective</h3>
                </div>
                <p><strong>Goal:</strong> Investigate and expose killers</p>
                <p><strong>Abilities:</strong> Learn if a player is a killer each night</p>
                <p><strong>Strategy:</strong> Gather evidence carefully, reveal information strategically</p>
            </div>
            
            <div class="role-card">
                <div class="role-header">
                    <span class="role-icon">🎙️</span>
                    <h3>Speaker</h3>
                </div>
                <p><strong>Goal:</strong> Facilitate fair and smooth gameplay</p>
                <p><strong>Abilities:</strong> Control game flow, announce results, ensure rules are followed</p>
                <p><strong>Strategy:</strong> Stay neutral, keep game moving, maintain fairness for all players</p>
            </div>
        </div>
    </div>
    
    <!-- Game Tips Panel -->
    <div class="info-panel" id="game-tips-panel">
        <div class="info-panel-header">
            <h2>💡 Game Tips</h2>
            <button class="close-panel-btn" onclick="closePanel()">✕</button>
        </div>
        <div class="info-panel-content">
            <div class="tip-card">
                <h3>🕵️ For Civilians</h3>
                <ul>
                    <li>Watch for inconsistencies in stories</li>
                    <li>Notice who defends killers or pushes innocent votes</li>
                    <li>Form trusted alliances, but be cautious</li>
                    <li>Use the chat to gather information</li>
                    <li>Don't reveal special roles too early</li>
                </ul>
            </div>
            
            <div class="tip-card">
                <h3>🎭 For Killers</h3>
                <ul>
                    <li>Act natural and participate in discussions</li>
                    <li>Don't defend other killers too obviously</li>
                    <li>Create reasonable doubt about innocent players</li>
                    <li>Coordinate kills to maximize impact</li>
                    <li>Target special roles when identified</li>
                </ul>
            </div>
            
            <div class="tip-card">
                <h3>🎲 General Strategy</h3>
                <ul>
                    <li>Pay attention to voting patterns</li>
                    <li>Use the process of elimination</li>
                    <li>Consider who benefits from each death</li>
                    <li>Don't rush important decisions</li>
                    <li>Communication is key to success</li>
                </ul>
            </div>
            
            <div class="tip-card">
                <h3>🎙️ Speaker Script (Full Cycle)</h3>
                <p><em>Use this word-for-word if you want to keep it smooth.</em></p>
                
                <h4>Game Start</h4>
                <div class="script-box">
                    <p>"Everyone, close your eyes."</p>
                    <p>"Killers, open your eyes and look around to recognize each other. Close your eyes again."</p>
                    <p>"The game begins…"</p>
                </div>
                
                <h4>Night Phase</h4>
                <div class="script-box">
                    <p>"Everyone, close your eyes."</p>
                    <p>"Killers, open your eyes and choose one person to eliminate."</p>
                    <p><em>(Confirm silently)</em> "Killers, close your eyes."</p>
                    <p>"Doctor, open your eyes and choose one person to save."</p>
                    <p><em>(Confirm silently)</em> "Doctor, close your eyes."</p>
                    <p>"Detective, open your eyes and choose one person to investigate."</p>
                    <p><em>(Show thumbs up/down)</em> "Detective, close your eyes."</p>
                    <p>"Everyone, wake up."</p>
                </div>
                
                <h4>Day Phase</h4>
                <div class="script-box">
                    <p><em>(Announce result of night: saved or eliminated)</em></p>
                    <p>"Discuss who you think the killer is. You have 5 minutes."</p>
                    <p>"It's time to vote. On the count of three, point to the player you want to eliminate."</p>
                    <p><em>(Count votes, announce elimination)</em></p>
                    <p>"The town has decided. [Name], you have been eliminated. Reveal your role."</p>
                    <p><em>Repeat until win condition is met.</em></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- About Panel -->
    <div class="info-panel" id="about-panel">
        <div class="info-panel-header">
            <h2>ℹ️ About</h2>
            <button class="close-panel-btn" onclick="closePanel()">✕</button>
        </div>
        <div class="info-panel-content">
            <div class="about-section">
                <h3>🎮 Mafia Game</h3>
                <p>A digital adaptation of the classic social deduction game, also known as Werewolf. This implementation features real-time multiplayer gameplay with modern web technologies.</p>
            </div>
            
            <div class="about-section">
                <h3>✨ Features</h3>
                <ul>
                    <li>Real-time multiplayer gameplay</li>
                    <li>Multiple game roles with unique abilities</li>
                    <li>In-game chat system</li>
                    <li>Speaker mode for game moderation</li>
                    <li>Responsive design for all devices</li>
                </ul>
            </div>
            
            <div class="about-section">
                <h3>🛠️ Technology</h3>
                <p>Built with modern web technologies including:</p>
                <ul>
                    <li>Frontend: HTML5, CSS3, JavaScript</li>
                    <li>Backend: Python Flask with Socket.IO</li>
                    <li>Real-time communication via WebSockets</li>
                </ul>
            </div>
            
            <div class="about-section">
                <h3>🎯 Perfect For</h3>
                <ul>
                    <li>Friends and family game nights</li>
                    <li>Team building activities</li>
                    <li>Online social gatherings</li>
                    <li>Strategy and deduction practice</li>
                </ul>
            </div>
        </div>
    </div>
    <nav class="top-dashboard" id="top-dashboard">
        <div class="top-dashboard-content">
            <span class="top-dashboard-title">Mafia Game</span>
            <button class="hamburger-menu" onclick="toggleMobileMenu()" title="Menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
        </div>
    </nav>

    <!-- Mobile Menu Sidebar -->
    <div class="mobile-menu-overlay" id="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
    <nav class="mobile-menu" id="mobile-menu">
        <div class="mobile-menu-header">
            <h3>Menu</h3>
            <button class="close-mobile-menu" onclick="closeMobileMenu()">✕</button>
        </div>
        <div class="mobile-menu-content">
            <button class="mobile-menu-item" onclick="openMobilePanel('how-to-play')">
                <span class="mobile-menu-icon">📖</span>
                <div class="mobile-menu-text">
                    <strong>How to Play</strong>
                    <small>Learn the game rules</small>
                </div>
            </button>
            <button class="mobile-menu-item" onclick="openMobilePanel('roles-info')">
                <span class="mobile-menu-icon">🎭</span>
                <div class="mobile-menu-text">
                    <strong>Roles Info</strong>
                    <small>Character abilities</small>
                </div>
            </button>
            <button class="mobile-menu-item" onclick="openMobilePanel('game-tips')">
                <span class="mobile-menu-icon">💡</span>
                <div class="mobile-menu-text">
                    <strong>Game Tips</strong>
                    <small>Strategy guides</small>
                </div>
            </button>
            <button class="mobile-menu-item" onclick="openMobilePanel('about')">
                <span class="mobile-menu-icon">ℹ️</span>
                <div class="mobile-menu-text">
                    <strong>About</strong>
                    <small>Game information</small>
                </div>
            </button>
        </div>
    </nav>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen active">
        <div class="splash-content">
            <div class="splash-logo">
                <img src="mafialogo.png" alt="Mafia Game Logo" class="splash-logo-img">
            </div>
            <h1 class="splash-title">Mafia Game</h1>
            <p class="splash-subtitle">A thrilling game of deception and strategy</p>
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <p class="loading-text">Loading...</p>
        </div>
    </div>

    <!-- Top Logo Section -->
    <div class="top-logo-section" id="top-logo-section" style="display: none;">
        <div class="logo-container">
            <img src="mafialogo.png" alt="Mafia Game Logo" class="top-logo">
        </div>
    </div>

    <!-- Welcome Screen (Outside Container) -->
    <div id="welcome-screen" class="game-screen active welcome-screen-container" style="display: none;">
        <div class="welcome-content">
            <h1 class="main-title">Mafia Game</h1>
            <p>A thrilling game of deception and strategy</p>
            <div class="welcome-buttons">
                <button class="btn welcome-btn" onclick="showCreateGame()">🎲 Create New Game</button>
                <button class="btn btn-secondary welcome-btn" onclick="showJoinGame()">🚪 Join Game</button>
            </div>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        <!-- Create Game Page -->
        <div id="create-game-screen" class="game-screen">
            <div class="page-header">
                <button class="btn-back" onclick="goToWelcome()">
                    <span class="back-arrow">←</span>
                    <span>Back</span>
                </button>
                <h1 class="main-title">Create New Game</h1>
                <p>Start a new Mafia game and invite friends</p>
            </div>
            
            <div class="page-content">
                <div class="form-group">
                    <label for="create-player-name">Your Name:</label>
                    <input type="text" id="create-player-name" placeholder="Enter your name" maxlength="20">
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="createGame()">🚀 Create Game Room</button>
                </div>
            </div>
        </div>

        <!-- Join Game Page -->
        <div id="join-game-screen" class="game-screen">
            <div class="page-header">
                <button class="btn-back" onclick="goToWelcome()">
                    <span class="back-arrow">←</span>
                    <span>Back</span>
                </button>
                <h1 class="main-title">Join Game</h1>
                <p>Enter the room code to join an existing game</p>
            </div>
            
            <div class="page-content">
                <div class="form-group">
                    <label for="join-player-name">Your Name:</label>
                    <input type="text" id="join-player-name" placeholder="Enter your name" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="room-code">Room Code:</label>
                    <input type="text" id="room-code" placeholder="Enter 6-character room code" maxlength="6" style="text-transform: uppercase;">
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="joinGame()">🎯 Join Game Room</button>
                </div>
            </div>
        </div>

        <!-- Original Game Content Screens -->
        <div class="header" id="original-header">
            <h1 class="main-title">Mafia Game</h1>
            <p>A thrilling game of deception and strategy</p>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="game-screen">
            <div class="lobby-header">
                <h2 class="main-title lobby-main-title">Game Lobby</h2>
                <p class="lobby-subtitle">Share this code with your friends & family</p>
                <div class="room-info">
                    <span>Room Code: <span class="room-code-display" id="lobby-room-code"></span></span>
                    <div class="room-code-actions">
                        <button class="btn-icon" onclick="copyRoomCode()" title="Copy Room Code">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                        </button>
                        <button class="btn-icon" onclick="shareRoom()" title="Share Room">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                <polyline points="16,6 12,2 8,6"/>
                                <line x1="12" y1="2" x2="12" y2="15"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="lobby-content-box">
                <div class="lobby-tabs">
                    <button class="lobby-tab-button active" onclick="showLobbyTab('players')">
                        <span class="tab-icon">👥</span> Players (<span id="player-count-tab">1</span>)
                    </button>
                    <button class="lobby-tab-button" onclick="showLobbyTab('chat')">
                        <span class="tab-icon">💬</span> Lobby Chat
                    </button>
                </div>

                <div id="lobby-players-content" class="lobby-tab-content active">
                    <ul class="players-list" id="players-list">
                        <!-- Player names will be dynamically inserted here -->
                    </ul>
                </div>

                <div id="lobby-chat-content" class="lobby-tab-content">
                    <div class="chat-messages" id="lobby-chat-messages"></div>
                    <div class="chat-input-container" id="lobby-chat-input-container" style="display: none;">
                        <input type="text" id="lobby-chat-input" placeholder="Type a message..." maxlength="500">
                        <button class="btn btn-secondary chat-send-btn" onclick="sendLobbyChatMessage()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="lobby-footer">
                <div class="speaker-warning" id="speaker-warning" style="display: none;">
                    <p>⚠️ A speaker must be assigned before starting the game.</p>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" id="start-game-btn" onclick="startGame()" style="display: none;">🚀 Start Game</button>
                    <button class="btn btn-danger" id="close-room-btn" onclick="closeRoom()" style="display: none;">� Close Room</button>
                    <button class="btn btn-secondary" id="leave-lobby-btn" onclick="leaveLobby()">🚪 Leave Lobby</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="game-screen">
            <div class="game-info">
                <div class="game-header">
                    <img src="mafialogo.png" alt="Mafia Game Logo" class="game-screen-logo">
                    <div class="phase-indicator" id="phase-indicator">
                        🌙 Night Phase
                    </div>
                </div>
                <p><strong>Your Role:</strong> <span id="your-role" class="role-badge">Unknown</span></p>
                <div id="role-description"></div>
            </div>

            <div class="grid">
                <div class="players-list">
                    <h3>👥 Alive Players (<span id="alive-count">0</span>)</h3>
                    <div id="alive-players-container"></div>
                </div>

                <div class="players-list">
                    <h3>💀 Eliminated Players</h3>
                    <div id="dead-players-container"></div>
                </div>
            </div>

            <!-- Role Summary -->
            <div class="role-summary" id="role-summary">
                <div class="role-summary-header" onclick="toggleRoleSummary()">
                    <h3>🎭 Role Information</h3>
                    <span class="toggle-icon" id="role-summary-toggle">▼</span>
                </div>
                <div class="role-info-grid" id="role-info-content">
                    <div class="role-info-item">
                        <span class="role-badge role-civilian">👤 Civilian</span>
                        <p>Find and eliminate killers during voting</p>
                    </div>
                    <div class="role-info-item">
                        <span class="role-badge role-killer">🔪 Killer</span>
                        <p>Eliminate players at night, avoid detection</p>
                    </div>
                    <div class="role-info-item">
                        <span class="role-badge role-doctor">🩺 Doctor</span>
                        <p>Save one player from elimination each night</p>
                    </div>
                    <div class="role-info-item">
                        <span class="role-badge role-detective">🔍 Detective</span>
                        <p>Investigate players to learn if they're killers</p>
                    </div>
                </div>
            </div>

            <div id="night-actions" class="hidden">
                <h3>🌙 Night Actions</h3>
                <div id="night-targets"></div>
            </div>

            <div id="day-voting" class="hidden">
                <h3>🗳️ Day Voting</h3>
                <p>Choose who to eliminate:</p>
                <div id="voting-targets"></div>
            </div>

            <div id="speaker-controls" class="hidden">
                <h3>🎙️ Speaker Controls</h3>
                <div class="action-buttons">
                    <button class="btn" id="process-night-btn" onclick="processNight()" disabled>Process Night</button>
                    <button class="btn" id="start-voting-btn" onclick="startVoting()" disabled>Start Voting</button>
                    <button class="btn" id="process-votes-btn" onclick="processVotes()" disabled>Process Votes</button>
                </div>
            </div>

            <div class="messages" id="game-messages"></div>

            <!-- Chat System -->
            <div class="chat-container" id="chat-container">
                <div class="chat-header">
                    <h3>💬 Game Chat</h3>
                    <span id="chat-status">Online</span>
                </div>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-container modern-chat" id="chat-input-container">
                    <input type="text" id="chat-input" placeholder="Type a message..." maxlength="500">
                    <button class="btn btn-secondary chat-send-btn" onclick="sendChatMessage()">➤</button>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-danger" onclick="leaveGame()">🚪 Leave Game</button>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="game-screen">
            <div class="game-info">
                <div class="game-over-header">
                    <img src="mafialogo.png" alt="Mafia Game Logo" class="game-over-logo">
                    <h2 id="game-over-title">🎉 Game Over!</h2>
                </div>
                <p id="game-over-message"></p>
            </div>

            <div class="players-list">
                <h3>👥 Final Players</h3>
                <div id="final-players-container"></div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="goToWelcome()">🏠 Back to Menu</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="game.js"></script>
</body>
</html>
